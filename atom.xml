<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://zanegjun.github.io</id>
    <title>ZaneGJun Blob</title>
    <updated>2020-02-03T15:35:45.782Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://zanegjun.github.io"/>
    <link rel="self" href="https://zanegjun.github.io/atom.xml"/>
    <subtitle>记录文字</subtitle>
    <logo>https://zanegjun.github.io/images/avatar.png</logo>
    <icon>https://zanegjun.github.io/favicon.ico</icon>
    <rights>All rights reserved 2020, ZaneGJun Blob</rights>
    <entry>
        <title type="html"><![CDATA[《全局光照技术》笔记-第一章之PBR]]></title>
        <id>https://zanegjun.github.io/post/lesslessquan-ju-guang-zhao-ji-zhu-greatergreater-bi-ji-di-yi-zhang-zhi-pbr</id>
        <link href="https://zanegjun.github.io/post/lesslessquan-ju-guang-zhao-ji-zhu-greatergreater-bi-ji-di-yi-zhang-zhi-pbr">
        </link>
        <updated>2020-02-03T12:14:44.000Z</updated>
        <content type="html"><![CDATA[<h4 id="物理上正确主要是指光在场景中的传输保持能量守恒"><mark><strong>物理上正确，主要是指光在场景中的传输保持能量守恒</strong></mark></h4>
<h2 id="双向反射分布函数brdf">双向反射分布函数(BRDF)</h2>
<p>  表示反射方向上的辐射亮度增量与入射方向辐射照度增量的比率。直观上讲，BRDF的值表示入射光方向单位立体角的能量在反射方向上反射的比率。它本质上指明了每个方向的入射光在各个方向上的反射光分布。</p>
<h3 id="菲涅尔公式">菲涅尔公式</h3>
<p>  <mark>当光由一种介质进入另一种不同的介质，在光滑表面发生反射和折射时，入射光被反射和折射的比率分别是多少，这就是菲涅尔方程描述的问题。</mark> 菲涅尔公式仅取决于入射角以及两种介质的折射系数。因为原始菲涅尔公式非常复杂，在渲染领域我们通常使用Schlick提出的一种比较简单且相对比较精确的模型。<br>
使用这个模型，只取决于入射光垂直于表面时的菲涅尔反射率的值，这个值我们可以在现实生活中找到大量物质的对应值，此外也可以通过材质的折射率得出。</p>
<h3 id="微面元理论微平面理论">微面元理论(微平面理论)</h3>
<p>  我们看到的绝大部分物质在一个像素的观察尺度上都不是绝对光滑的，这个尺度为微观尺度。在微观尺度下，一个像素接收到来自某个方向的光照并不是一单束光，由于一个像素的尺寸远远大于光子的尺寸，因此入射光实际上是很多束光，这些光与微观上具有不同方向法线的微面元交互，从而反射或者折射至不同的方向。<mark><strong>由于这种微观结构不能通过分析的方式精确模拟，因此只能通过统计的方式来模拟这种微观结构的分布</strong></mark><br>
  <strong>只有那些满足反射方向刚好在观察方向v的面元才能被看到，意味着这些可以被观察的面元的法线正好位于入射方向I和观察方向v的中间，这个矢量称为<mark>半矢量(half vector)</mark> h = (l+v)/|l+v|</strong>。<br>
  基于微面元的假设和理论，基于微面元理论的BRDF模型主要有这两部分因素决定:</p>
<ul>
<li>一个关于所欲微观面元的表面法线分布函数D，<mark>其中只有法线指向半矢量h方向的面元才会被观察到</mark>。</li>
<li>对法线方向处于半矢量h的微观面元，<mark>当且仅当他们在入射方向和观察方向没有被其他面元阻挡才能被观察到</mark>，因此需要一个表示几何遮挡关系的函数G。</li>
<li>再结合菲涅尔公式F</li>
</ul>
<h3 id="微观面元法线分布函数d">微观面元法线分布函数D</h3>
<p>  BRDF最重要的部分就是微观面元的法线分布函数NDF，它是表面的微观几何结构中，所有微观面的法线面向不同方向的概率，决定了光泽部分的宽度、形状以及其他特征。<strong>根据微观面理论的假设，这个法线分布函数是由表面的粗糙度决定的。</strong> 关于光泽BRDF球状分布，<mark>它具有一个很长的拖尾</mark>，这个拖尾比一般的光泽模型要长好几倍，传统的Blinn Phong和Gaussian分布都不能有效第表达这种拖尾效应。<br>
  Disney发现只有GGX分布具有最长的拖尾，一些研究表明单一的光泽叶分布通常不能精确地描述真实物质的光泽属性，建议使用多个光泽叶，Disney叶采用了两个GGX的组合俩表述这种更长的拖尾。<br>
  对于粗糙度，Disney选择使用 a = roughness平方 以产生一个更线性的变化，这使得设计师能够更直观地调整效果。</p>
<h3 id="微观面元集合遮挡函数g">微观面元集合遮挡函数G</h3>
<p>  G称为双向阴影遮挡函数，<mark>描述的是那些具有半矢量法线的微观面元中，有多少比例是同时被入射方向和反射方向看见的(或者说没有被阻挡的)。</mark></p>
<h3 id="漫反射brdf">漫反射BRDF</h3>
<p>  出于性能考虑，工业中比较流行的方案是朗伯BRDF(Lambert BRDF)，即光从各个方向以相同的亮度反射。Lambert漫反射模型假设折射进入表面内部的光经历了足够多的散射，因此失去了方向性，从而在各个方向的反射率为一个常数。</p>
<h2 id="材质模型">材质模型</h2>
<p>  在UE4中主要有4个参数和PBR材质相关，其他引擎例如Unity也差不多,分别是</p>
<ul>
<li>Base Color</li>
<li>Roughness</li>
<li>Metallic</li>
<li>Specular</li>
</ul>
<h4 id="base-color">Base Color</h4>
<p>  BaseColor，或者更一般说法是Diffuse，代表物体表面的真实颜色。<br>
  <mark><strong>任务物体在没有光照的时候都是看不见的，可以说一个物体本身是不具备任何“颜色”的(自发光物体除外),着色的过程是将光照射到物体表面，从而计算物体表面呈现的颜色的过程。</strong></mark><br>
  光与物体表面交互分为两种方式:<strong>(Specular)光泽反射和(Diffuse)漫反射(这里仅讨论绝缘体)。</strong><br>
  <mark><strong>对于光泽反射,它的反射率的RGB分量是一样的,即它不会改变入射光的颜色，仅改变其亮度。因此光泽反映的是光源本身，例如一个白色点光源在物体表面光泽部分看到的仍然是一个白色的(亮度被菲涅尔反射率缩放)小圆点形状，使用环境贴图作为光源则会在物体表面“印上”周围的环境。所以光泽反射几乎与物体表面的真实颜色无关。</strong></mark><br>
  <mark><strong>对于漫反射，它指的是光折射进物体内部，在物体内部经历一定的散射后重新从表面散射回原来的介质。由于散射的光失去了方向性，所以我们用一个固定的反射率常数来表示这个BRDF反射率，即baseColor。所以我们所说的物体表面的“真实颜色”,其实是一个反射率，它表示当其他光照在表面进行漫反射是，在每个方向的反射率是多少，如果我们使用白色光源照亮物体表面，则物体呈现baseColor的颜色，使用其他颜色的光源则呈现其他不同的颜色(由光源颜色与baseColor的乘积决定),所以baseColor反应的就是物体在白色光照下表面的真实颜色。</strong></mark></p>
<h4 id="roughness">Roughness</h4>
<p>  <mark>控制材质的粗糙度，越粗糙的表面，入射光越向更多的方向反射(菲涅尔反射率越低，更多光被吸收形成漫反射)，物体的表面越来越接近BaseColor的颜色；反之，光泽部分越来越窄，物体表面越来越光滑，高亮度的光泽使得物体表面越来越多地反射着周围的环境(或者光源的形状)。</mark> 当Roughness为0时表示物体表面绝对光滑，成镜面反射，如果光源为点光源，镜面反射使得物体表面能够清楚看到点光源的形状及颜色，如果光源为环境贴图，则光滑物体表面能够清晰地反映出周围环境；当Roughness为1时，物体表面完全漫反射，呈现BaseColor颜色。</p>
<h4 id="metallic">Metallic</h4>
<p>  控制表面的“金属感”，金属和非金属是一个非此即彼的概念，非金属的Metiallic值为0，而对于金属表面的Metallic值为1.对于纯净的物质，例如纯净的金属，石头，塑料凳，这些材质的Metallic值要么为0，有么为1。但是另外一些混合物质，如腐蚀的物体或者布满灰尘或生锈的金属，这些材质的Metallic可能需要介于0到1之间，对于这些介于0和1之间的材质，UE通过层级纹理实现两种材质之间的混合。<mark>材质可以分为金属和非金属，而金属对于折射进表面内部的光全部吸收，从而使金属材质将不会有光从表面内部再散射回来，<strong>因此金属材质没有漫反射部分。</strong></mark> 所以在Disney的BRDF模型中，他们对金属材质去掉漫反射部分，并使用BaseColor的值作为光泽的入射光进行计算。由于这种特殊的计算方式，Metallic属性没有一个线性的计算公式，因此大部分解决方案都是使用混合的方式实现0和1之外的插值。</p>
<h4 id="specular">Specular</h4>
<p>  Specular表示入射光被反射的量，或者说反射率。需要注意的是，对于非金属而言，他们的反射率往往与波长无关，即他们RGB的分量相同，因此他们对于光泽的反射，仅影响入射光的亮度，而通常不会影响其颜色。但是金属的反射率通常和波长是相关的，它对于入射光不同的颜色分量具有不同的反射率。</p>
<h2 id="双向散射分布函数">双向散射分布函数</h2>
<p>  BRDF通过少量几个参数就能够表述比较广泛的材质，单身对于折射，次表面散射需要用特别的方法处理。这些方法通常不能保证能量守恒，因此当整个渲染器是基于光线追踪计数计算光照时，这种能量的不守恒将被放大导致真个图像品质失真。<br>
  <mark>更为一般的双向散射分布函数(BSDF),它其实是BRDF和BTDF的总和。</mark> <strong>BTDF全称为双向折射分布函数</strong>，它和BRDF的形式基本一样，唯一的区别是BTDF的观察方向是在折射方向范围内。<br>
  <mark>这样，BSDF表示，给定某点的入射方向和出射方向，出射方向上辐射亮度增量和入射方向辐射照度增量的比率。</mark></p>
<h4 id="双向折射分布函数btdf">双向折射分布函数(BTDF)</h4>
<p>  工业中比较流行的模型是Bruce Walter提出的模型。这个模型同样基于微平面理论，即宏观表面有多个微观面元组成，每个面元绝对光滑，<strong><mark>光的折射遵循折射定理</mark></strong>。折射定理不仅描述光在折射时的弯曲现象，它也间接地约束了光在折射方向发散的范围。</p>
<h4 id="次表面散射">次表面散射</h4>
<p>  传统的BRDF模型并不包括对次表面散射的计算，即光从一个点进入表面内部，经过一定散射之后从另一个点散射回原介质。但是也包含了一般的漫反射之外的一些特性，主要是回射反射效果。Disney将原有的漫反射公式拆分为两部分：一部分是与微观结构有关的具有方向性的效果(回射反射),另一部分是与方向无关的一般的漫反射效果。这样当材质次表面散射的入射点和出射点距离小于一个像素尺寸是，还是使用原来的模型，当大于一个像素尺寸是，则使用新的BSSRDF模型替换与方向无关的部分漫反射。</p>
<h4 id="超薄表面的渲染">超薄表面的渲染</h4>
<p>  对于超薄表面，Disney假设他散射的入射点和出射点位于同一点，和固体物体一样，仍然使用specTrans参数在完全漫反射和完全光泽(包括反射和折射)之间混合。</p>
<h2 id="渲染方程">渲染方程</h2>
<pre><code class="language-math">光从x向方向w_o发射的辐射亮度 = 光源或者自发光在x处沿w_o的辐射亮度 + x处沿w_o防线的来自反射/折射的辐射亮度
</code></pre>
<p>通常反射/折射的辐射亮度需要对点x法线方向的半空间进行积分。</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[《全局光照技术》笔记-第一章]]></title>
        <id>https://zanegjun.github.io/post/lesslessquan-ju-guang-zhao-ji-zhu-greatergreater-bi-ji-di-yi-zhang</id>
        <link href="https://zanegjun.github.io/post/lesslessquan-ju-guang-zhao-ji-zhu-greatergreater-bi-ji-di-yi-zhang">
        </link>
        <updated>2020-02-03T12:04:10.000Z</updated>
        <content type="html"><![CDATA[<h2 id="11全局光照总览">1.1全局光照总览</h2>
<p>  主要介绍了全局光包含的几个大的方面，形成总体的认识。包括了以下几个方面。</p>
<ol>
<li>阴影。包括软阴影、硬阴影，应该是ShadowMap</li>
<li>环境遮蔽(AO)。主要增加考虑遮挡关系，使得阴影处的渲染更加逼真自然。一般离线生成，SSAO</li>
<li>反射。使用IBL采样Cubemap</li>
<li>间接光照。是全局光照最重要的部分，有各种技术，IBL，LightMap,</li>
<li>求谐光照(SH),LightProbe等等</li>
<li>焦散</li>
<li>散射</li>
</ol>
<h2 id="12辐射度量学">1.2辐射度量学</h2>
<ol>
<li>立体角。2d角度概念在3d的延伸,表示在3d空间中，从某个点观察，另一个物体有多“大”；以可以理解为3D空间中以某一点为起点的多个方向集合。通常使用单位球上一块区域面积大小来表示其对应的立体角大小。</li>
<li>辐射能量。基本单位</li>
<li>辐射亮度。从面A的一部分射出的光能量，是我们渲染方程最终要计算得值。计算的是单束光的量度。</li>
<li>辐射强度。面积A在某个方向上的辐射强度。</li>
<li>辐射照度（Irradiance）。一个点接收的来自各个方向的辐射亮度，表示表面的一个点接收的所有光照。LightMap中存储的就是辐射照度。</li>
</ol>
<h2 id="13-物体的表面着色">1.3 物体的表面着色</h2>
<ol>
<li>两种光学模型，波动光学与几何光学。波动光学由于以光的波长为测量尺寸，大大超出了计算机图形学的需求，所以计算机图形学中主要以几何光学作为光学模型。几何光学作出了几个假设:</li>
</ol>
<ul>
<li>物体表面绝对光滑</li>
<li>光仅可以被发射，反射或者传播</li>
<li>光以无限快的速度沿直线传播<br>
从以上几个假设下，反射有反射定律决定。</li>
</ul>
<ol start="2">
<li>光与表面的交互过程可以被以下描述：</li>
</ol>
<pre><code>graph LR
光源--&gt;与物体进行交互,部分被反射,部分被吸收并经过一定路径传播后沿其他方向从物体表面散射--&gt;被感应器接收形成图像
</code></pre>
<ol start="3">
<li>光源可以简单分为平行光，点光源，聚光灯</li>
<li>材质决定物体表面与光交互的一切。一般假设表面是绝对光滑的，但是实际情况是物体表面在一个像素尺度上，是不光滑的。<br>
在图形学中，材质可以分为两大类：<strong>金属与非金属</strong></li>
</ol>
<ul>
<li>金属：立即吸收所有折射的光照</li>
<li>非金属：折射光照在物体内部传播并根据物体属性在沿某个方向离开物体<br>
<strong>这种由物体内部发射回来的光通常不具有固定的方向性，所以这种反射成为漫反射(scattering)</strong><br>
在计算机图形学中，通常将反射和漫反射区分开，分别称为光泽(Specular)和漫反射(Diffuse)。</li>
<li><strong>Specular</strong>:光在物体表面的直接反射形成</li>
<li><strong>Diffuse</strong>:光进入物体表面，经过折射，吸收，多次散射过程之后重新从物体表面散射回表面外的光形成。漫反射光可以接受来自全部方向的光，因此需要对全空间进行积分计算，但是将与方向无关的部分分离，可以使用更简单的方法处理</li>
</ul>
<ol start="5">
<li>感应器如摄像机接受图像后会进行光栅化，但是会引起锯齿，这是由于采样不足导致的走样现象，相应有避免这种现象的反走样技术。</li>
</ol>
<h2 id="14-采样和反走样">1.4 采样和反走样</h2>
<p><strong>3D图像生成的本质是对各种连续函数(几何图形,BRDF分布函数)的采样,然后转化为对应的离散函数的过程。大部分采样发生在光栅化阶段。</strong></p>
<ol>
<li><strong>傅里叶变换</strong>：任何非周期的连续函数可以用正弦和/余弦和乘以一个加权函数的积分来表示，这个积分方程为傅里叶变换。傅里叶变换将一个连续非周期函数由其时间域或者空间域变换到其频率域。目的是在频率域我们可以发现该函数的一些重要特征，甚至一些对函数的操作在频率域进行更方便。</li>
<li><strong>卷积</strong>：两个函数f和g,在其中一个函数翻转180°之后，两个函数乘积的积分。<br>
<strong>卷积定理</strong>：对于卷积和傅里叶变换，可以证明，空间域中两个函数的卷积的傅里叶变换等于两个函数的傅里叶变换在频率域的乘积；反过来，如果有两个变换的乘积，可以通过计算傅里叶反变换得到空间域的卷积</li>
<li><strong>采样定理</strong>：冲激函数具有采样特性，可以简单地得到冲激位置处的函数值，那么如果我们定义一个具有均匀间隔的冲激函数，将这个冲激串作用于一个连续函数，那么其结果就得到对原始信号的均匀采样。借助冲激函数的傅里叶变换和卷积定理，可以得出采样定理，进而指导我们对函数进行采样。<strong>冲激串函数的傅里叶变换仍然是一个冲激串函数</strong>。一个连续函数被采样成一个离散函数后，其能够被重建为原函数的能力取决于采样点的密度，或称为采样率。<strong>采样率必须大于等于2x最大频率采样点/秒才能够被完美复原</strong></li>
<li><strong>几何走样</strong>:</li>
</ol>
<ul>
<li><strong>光栅化本质：</strong> 按照屏幕分辨率对可见性函数进行采样，即采样点之间的间距为一个像素，采样点的位置为每个像素的中点。</li>
<li><strong>几何走样：</strong> 由于对几何图形的可见性函数采样导致的走样称为几何走样，是计算机图形学中最严重的走样现象。<mark>这是由于可见性函数是一个连续函数，想要呈现很好的图像，必须要在图像上还原出很好的原始可见性函数，根据采样定律，必须使用两倍于可见性函数最高频率的采样率。但是三角形的可见性总是存在不连续，这种不连续导致无限大的频率，从而使其傅里叶变换不存在有限的频率带宽，因此没有采样率可以阻止走样发生；同时根据傅里叶变换的条件，只有定义域在无限的时间域或者空间域才能使其傅里叶变换具有有限的频率带宽，所以对于计算机图形学中有限的二维或者三维空间域，走样现象是不可避免的</mark>。</li>
<li><strong>着色走样：</strong> 由于像素着色器受限于屏幕分辨率所限导致的。主要是指，在着色器中对一些以分析的方式得到的连续函数的采样不足导致走样，而不是对纹理的采样不足。解决思路主要是将一些外部参数融入到光照计算，如BRDF，使“原始连续函数”更加平缓，在对这些光照结果采样。</li>
<li><strong>时间走样：</strong> 由于渲染帧率的限制使其对运动过程的采样不足导致的走样。解决方法一是运动模糊，但是计算成本高；二是针对当前帧渲染结果，生成一个速率缓存，然后使用这些方向在后处理阶段对其邻近像素点进行插值计算。</li>
</ul>
<ol start="5">
<li><strong>重建</strong> 卷积计算最本质也是最直观的特征是平滑，它通过对f的每个点考虑该点周围一定范围内的值对该点的影响，来消除该点与周围环境的频率的快速变化。这在计算机图形学运用广泛，大部分可能出现走样的地方，都可以在采样之前对原始函数进行平滑，以减轻走样现象。<mark>图像处理中，卷积的意义相当于使用一个蒙版遍历每一个像素点，分别计算蒙版内所有乘积的和，GPU中纹理过滤相关技术都是通过卷积的方式实现</mark></li>
<li><strong>重采样</strong> 最近邻内插值法、双线性插值法等。</li>
<li><strong>屏幕反走样</strong> 几何走样、着色器走样都跟屏幕分辨率有关，如果能从像素着色器解决走样问题,或许就能解决所有由于分辨率带来的走样。<mark>走样是一个采样问题，不能通过任何技术手段在采样之后消除这种由于采样不足导致的走样。走样是由于采样率低导致傅里叶变换的高频部分没有被覆盖，从而使相邻的采样点之间出现较大的差异。</mark></li>
</ol>
<ul>
<li><strong>过采样/超采样</strong> 针对特定分辨率的反走样技术，通过使用一个比输出分辨率略高的采样率对原始函数进行采样并对这个高分辨率的样本函数使用滤波器进行平滑，然后对这个高分辨率的样本函数进行重采样得到输出分辨率的图像。</li>
<li><strong>FSAA(全屏反走样)</strong> 以高分辨率渲染，然后对于相邻采样点取平均值得到最终图像。优点是实现简单，缺点是计算量大，每个子采样点都需要被进行一次着色。</li>
<li><strong>MSAA(多重采样反走样)</strong> 对于每个像素生成多个子采样点，并计算每个子采样点的深度和模板值，而对于颜色值，光栅化器对每个像素只调用一次像素着色器，然后将计算结果复制给每个子采样点。<mark>由于像素着色器只计算一次，相对FSAA大大减少了计算量，但是内存占用并没有减少。</mark> 纹理采样的位置一般是使用像素中心点位置，但是在MSAA下,几何图形可能只占据像素的小部分区域并不包括中心点,这时候再使用中心点采样纹理是不正确的；为了确保颜色采样的正确性,这个像素着色器使用的采样位置可以被调整到覆盖区域中某个点的位置，这种技术称为<strong>质心采样</strong>。<mark>对于一个被几何图形覆盖的像素点，它首先从像素中心点开始寻找，如果中心点没有被几何图形覆盖，则一次向外延伸直到找到一个被覆盖的子采样点，该点的位置将作为最终像素着色器对纹理采样的位置。</mark></li>
</ul>
]]></content>
    </entry>
</feed>